#! /bin/csh


#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-
#                                                                        
#    3dDeconvolve Regression
#
#    Auto-generated by ScriptWriter.py
#    kiefer katovich 2012
#
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-

set script_dir = `pwd`  

#-#-#-#-#-#-#-#-#-#-#-		Subjects					-#-#-#-#-#-#-#-#-#-#-#

set subjects = ( $1 )

#-#-#-#-#-#-#-#-#-#-#-		SID 						-#-#-#-#-#-#-#-#-#-#-#

#-#-#-#-#-#-#-#-#-#-#-		Cycle through subjects:		-#-#-#-#-#-#-#-#-#-#-#

echo starting to process SID

foreach subject ( ${subjects} )

    cd ../data/fmri/${subject}*
    echo processing ${subject} 

#-#-#-#-#-#-#-#-#-#-#-		Run makeVec on model file:		-#-#-#-#-#-#-#-#-#-#-#
	
	python2 $script_dir"/fmri/makeVec.py" $script_dir"/fmri/sid_vecs.txt" ${subject}
	
#-#-#-#-#-#-#-#-#-#-#-		Run waver on vectors:		-#-#-#-#-#-#-#-#-#-#-#

	waver -dt 2.0 -GAM -numout 384 -input gVnot_ant_sid.1D > gVnot_ant_sidc.1D
	waver -dt 2.0 -GAM -numout 384 -input lVnot_ant_sid.1D > lVnot_ant_sidc.1D
	waver -dt 2.0 -GAM -numout 384 -input hVm_gain_out_sid.1D > hVm_gain_out_sidc.1D
	waver -dt 2.0 -GAM -numout 384 -input hVm_loss_out_sid.1D > hVm_loss_out_sidc.1D
#-#-#-#-#-#-#-#-#-#-#-		Clean old regression file:		-#-#-#-#-#-#-#-#-#-#-#

	#if ( -e sid_reg+orig.BRIK ) then
	#	rm -rf sid_reg+orig*
	#endif
    rm -rf sid_reg+orig*
	
	cp -f $script_dir"/fmri/sid_runs.1D" ./

#-#-#-#-#-#-#-#-#-#-#-		Run 3dDeconvolve:		-#-#-#-#-#-#-#-#-#-#-#

    rm errts*
    rm blur_estimates*
    rm __ats_tmp*

	3dDeconvolve -float -jobs 8 -input sid_mbnf+orig -jobs 6 -concat sid_runs.1D -nfirst 0 -num_stimts 10 -polort 1 \
		-stim_file 1 '3dmotionsid.1D[1]' -stim_label 1 'roll' \
		-stim_file 2 '3dmotionsid.1D[2]' -stim_label 2 'pitch' \
		-stim_file 3 '3dmotionsid.1D[3]' -stim_label 3 'yaw' \
		-stim_file 4 '3dmotionsid.1D[4]' -stim_label 4 'dS' \
		-stim_file 5 '3dmotionsid.1D[5]' -stim_label 5 'dL' \
		-stim_file 6 '3dmotionsid.1D[6]' -stim_label 6 'dP' \
		-stim_file 7 'gVnot_ant_sidc.1D' -stim_label 7 'gVnot_ant_sid' \
		-stim_file 8 'lVnot_ant_sidc.1D' -stim_label 8 'lVnot_ant_sid' \
		-stim_file 9 'hVm_gain_out_sidc.1D' -stim_label 9 'hVm_gain_out_sid' \
		-stim_file 10 'hVm_loss_out_sidc.1D' -stim_label 10 'hVm_loss_out_sid' \
		-tout -fout -bucket sid_reg \
        #-errts errts_sid

    #adwarp -apar anat+tlrc -dpar errts_sid+orig -overwrite

    #3dFWHMx -automask -input errts_sid+tlrc >> blur_estimates_9mm_12_2016.errts_sid.1D
	
#-#-#-#-#-#-#-#-#-#-#-		Write zscored dataset:		-#-#-#-#-#-#-#-#-#-#-#

	if ( -e zsid_reg+orig.BRIK ) then
		rm -rf zsid_reg+orig*
	endif
	
	3dmerge -doall -1zscore -prefix zsid_reg sid_reg+orig

#-#-#-#-#-#-#-#-#-#-#-		Remove non-zscored dataset:		-#-#-#-#-#-#-#-#-#-#-#

	rm -rf sid_reg+orig*
	
	# returns to home directory
	cd $script_dir

end




#-#-#-#-#-#-#-#-#-#-#-		MID 						-#-#-#-#-#-#-#-#-#-#-#

echo starting to process MID

foreach subject ( ${subjects} )

    cd ../data/fmri/${subject}*
    echo processing ${subject} 

#-#-#-#-#-#-#-#-#-#-#-		Run makeVec on model file:		-#-#-#-#-#-#-#-#-#-#-#
	
	python2 $script_dir"/fmri/makeVec.py" $script_dir"/fmri/mid_vecs.txt" ${subject}
	
#-#-#-#-#-#-#-#-#-#-#-		Run waver on vectors:		-#-#-#-#-#-#-#-#-#-#-#

	waver -dt 2.0 -GAM -numout 384 -input gVnot_ant_mid.1D > gVnot_ant_midc.1D
	waver -dt 2.0 -GAM -numout 384 -input lVnot_ant_mid.1D > lVnot_ant_midc.1D
	waver -dt 2.0 -GAM -numout 384 -input hVm_gain_out_mid.1D > hVm_gain_out_midc.1D
	waver -dt 2.0 -GAM -numout 384 -input hVm_loss_out_mid.1D > hVm_loss_out_midc.1D

#-#-#-#-#-#-#-#-#-#-#-		Clean old regression file:		-#-#-#-#-#-#-#-#-#-#-#

	#if ( -e mid_reg+orig.BRIK ) then
	#	rm -rf mid_reg+orig*
	#endif
    rm -rf mid_reg+orig*
	
	cp -f $script_dir"/fmri/mid_runs.1D" ./

#-#-#-#-#-#-#-#-#-#-#-		Run 3dDeconvolve:		-#-#-#-#-#-#-#-#-#-#-#

	3dDeconvolve -float -jobs 8 -input mid_mbnf+orig -jobs 6 -concat mid_runs.1D -nfirst 0 -num_stimts 10 -polort 1 \
		-stim_file 1 '3dmotionmid.1D[1]' -stim_label 1 'roll' \
		-stim_file 2 '3dmotionmid.1D[2]' -stim_label 2 'pitch' \
		-stim_file 3 '3dmotionmid.1D[3]' -stim_label 3 'yaw' \
		-stim_file 4 '3dmotionmid.1D[4]' -stim_label 4 'dS' \
		-stim_file 5 '3dmotionmid.1D[5]' -stim_label 5 'dL' \
		-stim_file 6 '3dmotionmid.1D[6]' -stim_label 6 'dP' \
		-stim_file 7 'gVnot_ant_midc.1D' -stim_label 7 'gVnot_ant_mid' \
		-stim_file 8 'lVnot_ant_midc.1D' -stim_label 8 'lVnot_ant_mid' \
		-stim_file 9 'hVm_gain_out_midc.1D' -stim_label 9 'hVm_gain_out_mid' \
		-stim_file 10 'hVm_loss_out_midc.1D' -stim_label 10 'hVm_loss_out_mid' \
		-tout -fout -bucket mid_reg \

    #adwarp -apar anat+tlrc -dpar errts_mid+orig -overwrite

    #3dFWHMx -automask -input errts_mid+tlrc >> blur_estimates_9mm_12_2016.errts_mid.1D
	
#-#-#-#-#-#-#-#-#-#-#-		Write zscored dataset:		-#-#-#-#-#-#-#-#-#-#-#

	if ( -e zmid_reg_csfwm+orig.BRIK ) then
		rm -rf zmid_reg+orig*
	endif
	
	3dmerge -doall -1zscore -prefix zmid_reg mid_reg+orig

#-#-#-#-#-#-#-#-#-#-#-		Remove non-zscored dataset:		-#-#-#-#-#-#-#-#-#-#-#

	rm -rf mid_reg+orig*
	
	# returns to home directory
	cd $script_dir

end
